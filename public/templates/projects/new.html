<div class="modal-header">
    <h3 class="modal-title">Novo projeto</h3>
    <a href="javascript:;" ng-click="cancel()" class="cancel-modal">
      <i class="ace-icon fa fa-times bigger-200"></i>
    </a>
</div>


<div id="fuelux-wizard" class="wizard" data-initialize="wizard">
  <div class="modal-body">
    <ul class="steps wizard-steps">
      <li data-step="1" class="active">
        <span class="step">1</span>
        <span class="title">Dados gerais</span>
      </li>

      <li data-step="2">
        <span class="step">2</span>
        <span class="title">Definir fases</span>
      </li>

      <li data-step="3">
        <span class="step">3</span>
        <span class="title">Confirmar</span>
      </li>
    </ul>

    <div class="step-content pos-rel" id="step-container">
      <form class="form-horizontal" name="newProjectForm" wizard="fuelux-wizard" wizard-submit="createProject" wizard-model="project">
        <div class="step-pane active" data-step="1">
          <div class="form-group" ng-class="{ 'has-error': newProjectForm.name.$invalid && newProjectForm.name.$dirty }">
            <label class="col-xs-12 col-sm-3 control-label no-padding-right">Nome</label>

            <div class="col-xs-12 col-sm-6">
              <span class="block input-icon input-icon-right">
                <input type="text" class="width-100" ng-model="project.name" name="name">
              </span>
            </div>

            <div ng-messages="newProjectForm.name.$error" class="col-sm-9 col-sm-offset-3">
              <div ng-message="newProjectForm.name.$error.backend">
                <span class="help-block">{{ newProjectForm.name.$error.backend }}</span>
              </div>
            </div>
          </div>

          <div class="form-group" ng-class="{ 'has-error': newProjectForm.description.$invalid && newProjectForm.description.$dirty }">
            <label class="col-xs-12 col-sm-3 col-md-3 control-label no-padding-right">Descrição</label>

            <div class="col-xs-12 col-sm-6">
              <span class="block input-icon input-icon-right">
                <textarea name="description" ng-model="project.description" class="width-100"></textarea>
              </span>
            </div>

            <div ng-messages="newProjectForm.description.$error" class="col-sm-9 col-sm-offset-3">
              <div ng-message="newProjectForm.description.$error.backend">
                <span class="help-block">{{ newProjectForm.description.$error.backend }}</span>
              </div>
            </div>
          </div>

          <div class="form-group" ng-class="{ 'has-error': newProjectForm.client.$invalid && newProjectForm.client.$dirty }">
            <label class="col-xs-12 col-sm-3 control-label no-padding-right">Cliente</label>

            <div class="col-xs-12 col-sm-6">
              <span class="block input-icon input-icon-right">
                <input type="text" class="width-100" name="client" ng-model="project.client">
              </span>
            </div>

            <div ng-messages="newProjectForm.client.$error" class="col-sm-9 col-sm-offset-3">
              <div ng-message="newProjectForm.client.$error.backend">
                <span class="help-block">{{ newProjectForm.client.$error.backend }}</span>
              </div>
            </div>
          </div>
        </div>

        <div class="step-pane" data-step="2">
          <p class="lead">Adicione as fases do projeto, uma por uma, informando o nome, o período em que ela irá ocorrer e escolhendo uma cor, pra facilitar na identificação.</p>
          <p>O projeto não tem fases definidas? Clique no <strong>avancar</strong>.</p>

          <div class="well"
               id="projectPhaseFields"
               rails-complex-form
               root-resource="project"
               form-template="{{ 'templates/projects/project_phase_fields.html' }}"
               validate-child="validateProjectPhase(child)"
               child-factory="projectPhaseFactory(child)"
               children-attribute="project_phases_attributes"
               changed-callback="changedCallback(child)"
               remove-child-setter="setRemoveProjectPhase(fn)"
               extra-data="opts">
          </div>

          <div id="project_phases">
            <h3>Fases do projeto</h3>

            <p ng-if="!project || !project.project_phases_attributes || (project.project_phases_attributes|destroyed).length == 0" text-align="center">PARA ADICIONAR UMA FASE NO PROJETO, PREENCHA O FORMULÁRIO ACIMA.</p>

            <hr/>

            <table class="table table-striped table-bordered table-hover" ng-if="project && project.project_phases_attributes && (project.project_phases_attributes|destroyed).length > 0">
              <thead>
                <tr>
                  <th>Nome</th>
                  <th>Início</th>
                  <th>Fim</th>

                  <th class="tableActions">Remover?</th>
                </tr>
              </thead>

              <tbody>
                <tr ng-repeat="projectPhase in project.project_phases_attributes" ng-class="projectPhase._destroy && 'destroyed'">
                  <td style="background:{{projectPhase.color}}">{{ projectPhase.name }}</td>
                  <td>{{ projectPhase.start_at|date:'dd/MM/yyyy'}}</td>
                  <td class="hidden-480">{{ projectPhase.end_at|date:'dd/MM/yyyy' }}</td>
                  <td class="tableActions">
                    <a href="javascript:;" class="btn btn-xs btn-danger" ng-click="removeProjectPhase($index)"><i class="ace-icon fa fa-trash-o bigger-120"></i></a>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <div class="step-pane" id="confirmProject" data-step="3">
          <p class="lead">Confirme as informações antes de salvar o projeto.</p>

          <h4>Dados gerais</h4>

          <hr/>

          <div class="col-md-9 col-md-offset-3">
            <dl class="dl-horizontal">
              <dt>Nome</dt>
              <dd>
                {{ project.name }}
                <em ng-if="!project.name">sem nome</em>
              </dd>

              <dt>Descrição</dt>
              <dd>
                {{ project.description }}
                <em ng-if="!project.description">sem descrição</em>
              </dd>

              <dt>Cliente</dt>
              <dd>
                {{ project.client }}
                <em ng-if="!project.client">sem cliente</em>
              </dd>
            </dl>
          </div>

          <div class="clearfix"></div>

          <h4>Fases do projeto</h4>

          <hr/>

          <p ng-if="!project || !project.project_phases_attributes || project.project_phases_attributes == 0" text-align="center">NÃO HÁ FASES ADICIONADAS. PARA ADICIONAR, VOLTE AO PASSO ANTERIOR.</p>

          <gantt load-data="setGanttLoad(fn)"
                 allow-task-row-switching="false"
                 show-tooltips="false"
                 view-scale="'day'"
                 column-width="scale === 'month' && 17 || (scale === 'week' && 10 || 2)"
                 column-sub-scale="scale === 'month' && 30 || (scale === 'week' && 7 || 1)"
                 allow-task-resizing="false"
                 allow-task-moving="false"
                 allow-task-sorting="false"
                 clear-data="setGanttClear(fn)"></gantt>
        </div>
      </form>
    </div>
  </div>

  <div class="modal-footer">
    <div class="wizard-actions">
      <!-- #section:plugins/fuelux.wizard.buttons -->
      <button class="btn btn-prev" disabled="disabled">
        <i class="ace-icon fa fa-arrow-left"></i>
        Voltar
      </button>

      <button class="btn btn-success btn-next" data-last="Salvar">
        Avançar
        <i class="ace-icon fa fa-arrow-right icon-on-right"></i>
      </button>
    <!-- /section:plugins/fuelux.wizard.buttons -->
    </div>
  </div>
</div>